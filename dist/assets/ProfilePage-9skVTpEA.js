import{u as v,r as i,b as w,j as e,L as k}from"./index-CLjvfxVe.js";import{l as h}from"./bookings-D-FzDijF.js";function B(){var m,g;const{user:s,loading:n,logout:f}=v(),[a,d]=i.useState([]),[p,r]=i.useState(!1),[c,x]=i.useState(null),o=w();i.useEffect(()=>{!n&&!s&&o("/login")},[s,n,o]),i.useEffect(()=>{async function t(){if(s){r(!0),x(null);try{const l=await h(s.$id);d(l||[])}catch(l){console.warn("Failed to load bookings for profile:",(l==null?void 0:l.message)||l),x("Failed to load bookings")}finally{r(!1)}}}t()},[s]);function u(){f(),o("/")}function j(){try{localStorage.removeItem("local_bookings"),s&&h(s.$id).then(t=>d(t||[])).catch(()=>{})}catch(t){console.warn("Failed to clear local bookings:",(t==null?void 0:t.message)||t)}}const b=a.length,y=a.filter(t=>(t.status||"").toLowerCase()==="paid").length,N=a.filter(t=>(t.status||"").toLowerCase()==="pending").length;return e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Your Profile"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:j,className:"px-3 py-2 rounded bg-yellow-100 text-yellow-800 border border-yellow-200 hover:bg-yellow-200",children:"Clear local bookings"}),e.jsx("button",{onClick:u,className:"px-3 py-2 rounded bg-red-600 text-white hover:bg-red-700",children:"Sign out"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"col-span-1 bg-white rounded shadow p-4 flex flex-col items-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-indigo-600 text-white flex items-center justify-center text-2xl font-bold",children:s!=null&&s.name?s.name.split(" ").map(t=>t[0]).slice(0,2).join(""):(g=(m=s==null?void 0:s.email)==null?void 0:m[0])==null?void 0:g.toUpperCase()}),e.jsx("h2",{className:"mt-3 font-semibold",children:(s==null?void 0:s.name)||"Unnamed"}),e.jsx("div",{className:"text-sm text-gray-600",children:s==null?void 0:s.email}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:["ID: ",s==null?void 0:s.$id]})]}),e.jsxs("div",{className:"col-span-2 bg-white rounded shadow p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"My Bookings"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Total: ",b]})]}),e.jsxs("div",{className:"flex gap-3 text-sm mb-4",children:[e.jsxs("div",{className:"px-3 py-1 rounded bg-green-100 text-green-800",children:["Paid: ",y]}),e.jsxs("div",{className:"px-3 py-1 rounded bg-yellow-100 text-yellow-800",children:["Pending: ",N]})]}),p?e.jsx("div",{className:"text-gray-500",children:"Loading bookings..."}):c?e.jsx("div",{className:"text-red-500",children:c}):a.length===0?e.jsx("div",{className:"text-gray-500",children:"You have no bookings yet. Browse trips to book your next adventure."}):e.jsx("ul",{className:"space-y-3",children:a.map(t=>e.jsxs("li",{className:"border rounded p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(k,{to:`/trips/${t.tripId}`,className:"font-semibold text-indigo-600 hover:underline",children:t.tripTitle||"Trip"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Date: ",t.date||"N/A"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`px-2 py-1 rounded text-sm ${(t.status||"").toLowerCase()==="paid"?"bg-green-100 text-green-800":(t.status||"").toLowerCase()==="failed"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:t.status||"pending"}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["ID: ",t.id]})]})]},t.id))})]})]})]})}export{B as default};
