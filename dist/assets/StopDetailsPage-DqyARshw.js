import{c as L,u as M,r as i,j as e,L as h,A as $}from"./index-CLjvfxVe.js";import{h as P,b as y,a as U}from"./trips-BOHQsqPE.js";import{m as X}from"./proxy-B5GhTnH_.js";function T(){const{id:x}=L(),{isAdmin:S}=M(),[s,k]=i.useState(null),[I,A]=i.useState(!0),[g,d]=i.useState(0),[f,j]=i.useState(0),m=i.useRef(!0),l=i.useRef(null);i.useEffect(()=>{(async()=>{try{const t=await P(x);k(t)}catch(t){console.error(t)}finally{A(!1)}})()},[x]);const a=Array.isArray(s==null?void 0:s.images)?s.images:s!=null&&s.imageId?[s.imageId]:[],r=i.useCallback(()=>{j(1),d(t=>(t+1)%Math.max(1,a.length)),m.current=!1},[a.length]),c=i.useCallback(()=>{j(-1),d(t=>(t-1+Math.max(1,a.length))%Math.max(1,a.length)),m.current=!1},[a.length]);i.useEffect(()=>{d(0),m.current=!0},[a.length]),i.useEffect(()=>{const t=n=>{n.key==="ArrowLeft"&&c(),n.key==="ArrowRight"&&r()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[r,c]);const p=t=>{var n;l.current=t.clientX||t.touches&&((n=t.touches[0])==null?void 0:n.clientX)||null},b=t=>{var w;const n=t.clientX||t.changedTouches&&((w=t.changedTouches[0])==null?void 0:w.clientX)||null;if(l.current==null||n==null)return;const o=n-l.current;Math.abs(o)>50&&(o>0?c():r()),l.current=null};if(I)return e.jsx("div",{className:"p-6",children:"Loading stop..."});if(!s)return e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Stop not found"}),e.jsx(h,{to:"/",children:"Back"})]});const u=a.length>0?a[g]:null,N=u?y(u,{full:!1}):"",v=s!=null&&s.videoId?U(s.videoId):"",E={enter:t=>({x:t>0?300:-300,opacity:0}),center:{x:0,opacity:1},exit:t=>({x:t>0?-300:300,opacity:0})};return e.jsxs("div",{className:"p-4 max-w-5xl mx-auto",children:[e.jsxs("section",{className:"relative h-80 md:h-96 rounded overflow-hidden bg-gray-200",children:[e.jsx($,{initial:!1,custom:f,children:e.jsx(X.div,{custom:f,variants:E,initial:"enter",animate:"center",exit:"exit",transition:{type:"tween",duration:.45},className:"absolute inset-0 flex items-center justify-center bg-black/10",onMouseDown:p,onMouseUp:b,onTouchStart:p,onTouchEnd:b,children:N?e.jsx("img",{src:N,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:"No image"})},u||"empty")}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-black/10"}),e.jsx("div",{className:"absolute bottom-3 left-3 z-20 text-white",children:e.jsx("h2",{className:"text-lg font-bold",children:s.name})}),e.jsxs("div",{className:"absolute bottom-3 right-3 z-20 flex gap-2 items-center",children:[e.jsx("div",{className:"text-sm mr-3 text-white/90",children:a.length>0?`${g+1} / ${a.length}`:"0 / 0"}),e.jsx("button",{onClick:c,className:"bg-white/20 text-white px-3 py-1 rounded",children:"◀"}),e.jsx("button",{onClick:r,className:"bg-white/20 text-white px-3 py-1 rounded",children:"▶"})]})]}),e.jsx("div",{className:"text-gray-700 my-4",children:s.description}),v&&e.jsxs("div",{className:"my-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Watch video"}),e.jsx("video",{controls:!0,src:v,className:"w-full max-h-96 rounded-lg shadow-md"})]}),a.length>0&&e.jsxs("div",{className:"my-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Photos"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:a.map((t,n)=>e.jsx("img",{src:y(t,{full:!1}),alt:`${s.name} ${n+1}`,className:"w-full h-40 object-cover rounded-md shadow-sm"},n))})]}),e.jsxs("div",{className:"my-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"More details"}),e.jsx("div",{className:"prose max-w-none text-sm text-gray-700",children:e.jsx("ul",{children:Object.keys(s||{}).map(t=>{if(["id","tripId","name","description","imageId","images","videoId","$id"].includes(t))return null;const n=s[t];if(n==null)return null;const o=typeof n=="object"?JSON.stringify(n):String(n);return e.jsxs("li",{className:"mb-1",children:[e.jsxs("strong",{className:"capitalize mr-2",children:[t,":"]})," ",e.jsx("span",{className:"break-words",children:o})]},t)})})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(h,{to:`/trips/${s.tripId}`,className:"text-blue-600 underline",children:"Back to trip"}),S&&e.jsx(h,{to:`/admin?editStop=${s.id}`,className:"text-sm bg-orange-500 text-white px-3 py-1 rounded-md shadow",children:"Edit in Admin panel"})]})]})}export{T as default};
